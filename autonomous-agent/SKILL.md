---
name: autonomous-agent
description: 当用户说"开始"、"继续"、"自主执行"、"自动规划"、"自动修复"、"autonomous"、"agent执行"、"智能工作流"、"智能路由"时调用。能动态规划任务、自动选择工具、失败后自动修复。当没有匹配工作流时自动联网搜索并生成新工作流。强制执行验证验收，确保代码质量。默认开启静默模式，不停止询问用户，自动处理问题直到完成。
---

# Autonomous Agent - 自主执行层 v3.0

## ⚠️ 核心原则：知识先行，规划在后

**禁止**：用旧知识直接规划执行
**强制**：必须先完成知识调研，再进行任务规划

---

## 一、完整执行流程（七层架构）

```
用户输入
    ↓
┌─────────────────────────────────────────────────────────────┐
│  第零层：初始化检查层 (Initialization) ⭐ 最先执行            │
├─────────────────────────────────────────────────────────────┤
│  1. 检查 .trae/knowledge/ 目录是否存在                       │
│     └─ 不存在 → 自动创建                                     │
│  2. 检查 index.json 是否存在                                 │
│     └─ 不存在 → 创建空索引                                   │
│  3. 检查 _templates/ 目录是否存在                            │
│     └─ 不存在 → 创建模板目录和模板文件                       │
└─────────────────────────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────────────────────────┐
│  第一层：任务解析层 (Task Parser)                             │
├─────────────────────────────────────────────────────────────┤
│  1. 提取任务核心目标                                          │
│  2. 识别涉及的技术领域/行业                                   │
│  3. 判断是否需要外部知识（新框架/新版本/新领域 = 必须调研）    │
└─────────────────────────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────────────────────────┐
│  第二层：知识调研层 (Knowledge Research) ⭐ 核心层            │
├─────────────────────────────────────────────────────────────┤
│  【强制执行】当涉及以下情况时，必须完成知识调研：              │
│  - 新框架/新库（首次使用或版本更新）                          │
│  - 行业特定知识（金融/医疗/游戏等）                           │
│  - 技术栈变更（如 Vue2 → Vue3）                              │
│  - 跨领域任务（如 AI + Web）                                 │
│  - ⭐ 无可用工作流（本地/GitHub/教程都找不到时必须调研）       │
└─────────────────────────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────────────────────────┐
│  第三层：工作流匹配层 (Workflow Matcher)                      │
├─────────────────────────────────────────────────────────────┤
│  [1/4] 检查本地工作流 → 找到 → 基于知识调研调整后执行         │
│  [2/4] 搜索 GitHub 开源项目 → 学习实现方案后执行              │
│  [3/4] 搜索文章和教程 → 提取步骤后执行                        │
│  [4/4] 基于知识调研结果生成工作流 → 执行                      │
└─────────────────────────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────────────────────────┐
│  第四层：执行层 (Executor)                                   │
├─────────────────────────────────────────────────────────────┤
│  执行具体任务                                                 │
│      ├── 成功 → 继续                                         │
│      └── 失败 → 知识补充调研 → 本地修复 → 联网搜索 → 跳过     │
└─────────────────────────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────────────────────────┐
│  第五层：验证层 (Validator) - 强制执行                        │
├─────────────────────────────────────────────────────────────┤
│  1. 代码质量验证（语法/类型/内存泄漏）                        │
│  2. 运行时验证（功能测试/边界测试）                           │
│  3. 目标达成验证                                              │
└─────────────────────────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────────────────────────┐
│  第六层：知识沉淀层 (Knowledge Persistence)                   │
├─────────────────────────────────────────────────────────────┤
│  - 保存工作流（如果是新的）                                   │
│  - 保存知识摘要（供后续复用）                                 │
│  - 记录踩坑经验（避免重复犯错）                               │
└─────────────────────────────────────────────────────────────┘
    ↓
输出报告
```

---

## 二、知识调研层详细协议

### 2.1 知识源优先级矩阵

| 优先级 | 知识源类型 | 示例 | 使用场景 |
|--------|-----------|------|---------|
| P0 | 官方文档 | react.dev, vuejs.org, python.org | API用法、最佳实践 |
| P1 | 行业标准 | OpenAPI Spec, W3C标准 | 规范、协议 |
| P2 | 官方博客 | React Blog, Node.js Blog | 版本变更、迁移指南 |
| P3 | GitHub仓库 | 官方仓库、Issues、Discussions | 实际问题、已知Bug |
| P4 | 技术社区 | Stack Overflow, Dev.to | 具体问题解决 |
| P5 | 专业教程 | 官方教程、认证课程 | 系统学习 |

### 2.2 知识调研触发条件

**必须触发知识调研的情况：**

- 新技术栈：首次使用的框架/库
- 版本升级：如 Vue2→Vue3, React 17→18
- 行业特定：金融/医疗/游戏等领域知识
- 跨领域整合：AI + Web, 移动端 + 后端
- 无可用工作流：本地/GitHub/教程都找不到时

---

## 三、自动修复机制

```
步骤执行失败
    ↓
尝试本地修复（最多3次）
    ↓ 失败
联网搜索解决方案
    ↓ 找到
执行联网方案
    ↓ 失败
跳过继续下一步（静默模式）
```

---

## 四、触发词

| 触发词 | 说明 |
|--------|------|
| `开始`、`继续` | 启动自主执行 |
| `自主执行`、`自动规划` | 动态规划任务 |
| `自动修复` | 失败后自动修复 |
| `autonomous`、`agent执行` | 英文触发词 |
| `智能工作流`、`智能路由` | 智能模式 |