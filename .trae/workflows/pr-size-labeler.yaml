name: PR å¤§å°è‡ªåŠ¨æ ‡è®°
version: "2.0.0"
description: æ ¹æ®ä»£ç å˜æ›´è¡Œæ•°è‡ªåŠ¨æ ‡è®°PRå¤§å°ï¼Œè¶…å¤§PRè‡ªåŠ¨æé†’æ‹†åˆ†
source: "æ”¹ç¼–è‡ªGitHub Actions size-labelå·¥ä½œæµ"
category: "code-quality"
tags: ["pr", "label", "size", "code-review", "automation"]
triggers:
  - "æ ‡è®°PRå¤§å°"
  - "PRå¤§å°"
  - "size label"
  - "pr size"

steps:
  - id: 1
    name: åˆ›å»ºè¾“å‡ºç›®å½•
    action: run_command
    params:
      command: "python -c \"import os; os.makedirs('output', exist_ok=True)\""
      timeout: 5

  - id: 2
    name: è·å–Gitå˜æ›´ç»Ÿè®¡
    action: run_command
    params:
      command: "git diff --stat HEAD~1 2>nul || python -c \"print('æ— Gitå†å²ï¼Œç»Ÿè®¡å½“å‰ä»£ç ')\""
      save_as: git_stats
      timeout: 10

  - id: 3
    name: è®¡ç®—å˜æ›´è¡Œæ•°
    action: run_command
    params:
      command: "git diff --numstat HEAD~1 2>nul | python -c \"import sys; lines=[l.split() for l in sys.stdin if l.strip()]; added=sum(int(l[0]) for l in lines if l[0].isdigit()); deleted=sum(int(l[1]) for l in lines if l[1].isdigit()); print(f'æ–°å¢: {added}è¡Œ, åˆ é™¤: {deleted}è¡Œ, æ€»å˜æ›´: {added+deleted}è¡Œ')\" || echo æ— æ³•è®¡ç®—å˜æ›´"
      save_as: change_stats
      timeout: 10

  - id: 4
    name: è¯„ä¼°PRå¤§å°
    action: run_command
    params:
      command: "git diff --numstat HEAD~1 2>nul | python -c \"import sys; lines=[l.split() for l in sys.stdin if l.strip()]; total=sum(int(l[0])+int(l[1]) for l in lines if l[0].isdigit() and l[1].isdigit()); size='XS' if total<50 else 'S' if total<100 else 'M' if total<300 else 'L' if total<500 else 'XL'; print(f'æ€»å˜æ›´: {total}è¡Œ, å¤§å°: {size}')\" || echo æ— æ³•è¯„ä¼°å¤§å°"
      save_as: size_eval
      timeout: 10

  - id: 5
    name: ç”Ÿæˆæ ‡ç­¾é…ç½®
    action: run_command
    params:
      command: |
        python -c "
        config = '''# PRå¤§å°æ ‡ç­¾é…ç½®
size:
  xs: {max: 50, color: '00ff00', name: 'size/XS'}
  s: {max: 100, color: '90ff00', name: 'size/S'}
  m: {max: 300, color: 'ffff00', name: 'size/M'}
  l: {max: 500, color: 'ff9900', name: 'size/L'}
  xl: {max: 999999, color: 'ff0000', name: 'size/XL'}

messages:
  xl_warning: 'æ­¤PRå˜æ›´è¾ƒå¤§(>500è¡Œ)ï¼Œå»ºè®®æ‹†åˆ†'
  l_notice: 'æ­¤PRå˜æ›´ä¸­ç­‰(301-500è¡Œ)ï¼Œè¯·ç¡®ä¿æµ‹è¯•è¦†ç›–'
'''
        with open('output/pr-size-config.yaml', 'w') as f:
            f.write(config)
        print('é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ')
        "

  - id: 6
    name: éªŒè¯é…ç½®æ–‡ä»¶
    action: verify
    type: file_exists
    path: "output/pr-size-config.yaml"
    fail_message: "é…ç½®æ–‡ä»¶æœªç”Ÿæˆ"

  - id: 7
    name: ç”ŸæˆæŠ¥å‘Š
    action: generate_document
    params:
      output: "output/pr-size-report-{{current_date}}.md"
      content: |
        # PRå¤§å°è¯„ä¼°æŠ¥å‘Š
        
        **ç”Ÿæˆæ—¶é—´**: {{current_date}} {{current_time}}
        
        ## å˜æ›´ç»Ÿè®¡
        
        {{git_stats}}
        
        ## è¡Œæ•°ç»Ÿè®¡
        
        {{change_stats}}
        
        ## å¤§å°è¯„ä¼°
        
        {{size_eval}}
        
        ## æ ‡ç­¾æ ‡å‡†
        
        | æ ‡ç­¾ | è¡Œæ•°èŒƒå›´ | é¢œè‰² |
        |------|---------|------|
        | size/XS | 0-50 | ğŸŸ¢ |
        | size/S | 51-100 | ğŸŸ¡ |
        | size/M | 101-300 | ğŸŸ  |
        | size/L | 301-500 | ğŸ”´ |
        | size/XL | >500 | âš« |

  - id: 8
    name: éªŒè¯æŠ¥å‘Šç”Ÿæˆ
    action: verify
    type: file_exists
    path: "output/pr-size-report-{{current_date}}.md"
    fail_message: "æŠ¥å‘Šæœªç”Ÿæˆ"

  - id: 9
    name: è¾“å‡ºç»“æœ
    action: notify
    params:
      message: |
        âœ… PRå¤§å°è¯„ä¼°å®Œæˆï¼
        
        å˜æ›´ç»Ÿè®¡:
        {{change_stats}}
        
        å¤§å°è¯„ä¼°:
        {{size_eval}}
        
        æŠ¥å‘Š: output/pr-size-report-{{current_date}}.md
