name: swarm-execution
description: æ™ºèƒ½ä½“èœ‚ç¾¤æ‰§è¡Œå·¥ä½œæµ - å¹¶è¡Œæ‰§è¡Œå¤æ‚ä»»åŠ¡ï¼Œç»“åˆ Trae Solo å¤šä»»åŠ¡èƒ½åŠ›
version: "1.0.0"
category: "swarm"
tags: ["parallel", "multi-agent", "orchestration", "dag"]

trigger:
  type: auto
  keywords:
    - èœ‚ç¾¤
    - å¹¶è¡Œæ‰§è¡Œ
    - å¤šæ™ºèƒ½ä½“
    - swarm
    - /swarm
    - å¯åŠ¨èœ‚ç¾¤

dependencies:
  - swarm-orchestrator

# èœ‚ç¾¤é…ç½®
swarm_config:
  orchestrator:
    skill: "swarm-orchestrator"
    
  workers:
    researcher:
      max_instances: 2
      timeout: 180
      capabilities:
        - web_search
        - doc_reading
        - knowledge_extraction
        
    coder:
      max_instances: 3
      timeout: 600
      capabilities:
        - code_writing
        - refactoring
        - bug_fixing
        
    tester:
      max_instances: 2
      timeout: 300
      capabilities:
        - unit_test
        - integration_test
        - performance_test
        
    writer:
      max_instances: 1
      timeout: 180
      capabilities:
        - api_documentation
        - user_guide
        - readme
        
    reviewer:
      max_instances: 1
      timeout: 180
      capabilities:
        - code_review
        - security_scan
        - best_practices

# é€šä¿¡é…ç½®
communication:
  method: "file_based"
  queue_file: ".trae/swarm/queue.json"
  status_file: ".trae/swarm/status.json"
  results_dir: ".trae/swarm/results"
  heartbeat_interval: 10

# æ‰§è¡Œæµç¨‹
workflow:
  phases:
    - id: 1
      name: "ä»»åŠ¡åˆ†æ"
      action: "analyze"
      description: "åˆ†æä»»åŠ¡å¤æ‚åº¦ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦èœ‚ç¾¤æ¨¡å¼"
      handler: "orchestrator.analyze_task"
      
    - id: 2
      name: "ä»»åŠ¡åˆ†è§£"
      action: "decompose"
      description: "å°†å¤æ‚ä»»åŠ¡æ‹†è§£ä¸ºå­ä»»åŠ¡"
      handler: "orchestrator.decompose_task"
      condition: "analysis.swarm_mode == true"
      
    - id: 3
      name: "æ„å»ºä¾èµ–å›¾"
      action: "build_dag"
      description: "è¯†åˆ«ä»»åŠ¡é—´ä¾èµ–å…³ç³»"
      handler: "orchestrator.build_dag"
      condition: "analysis.swarm_mode == true"
      
    - id: 4
      name: "åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—"
      action: "create_queue"
      description: "å°†ä»»åŠ¡å†™å…¥é˜Ÿåˆ—æ–‡ä»¶"
      handler: "orchestrator.create_queue"
      condition: "analysis.swarm_mode == true"
      
    - id: 5
      name: "åˆ†å‘ä»»åŠ¡"
      action: "dispatch"
      description: "å°†ä»»åŠ¡åˆ†å‘ç»™ Worker"
      handler: "dispatcher.dispatch_tasks"
      
    - id: 6
      name: "å¹¶è¡Œæ‰§è¡Œ"
      action: "execute_parallel"
      description: "Worker å¹¶è¡Œæ‰§è¡Œä»»åŠ¡"
      handler: "worker.execute"
      parallel: true
      
    - id: 7
      name: "è¿›åº¦ç›‘æ§"
      action: "monitor"
      description: "ç›‘æ§æ‰§è¡Œè¿›åº¦"
      handler: "orchestrator.monitor_progress"
      loop: true
      interval: 5
      
    - id: 8
      name: "ç»“æœæ•´åˆ"
      action: "aggregate"
      description: "æ”¶é›†å¹¶æ•´åˆæ‰€æœ‰ç»“æœ"
      handler: "orchestrator.aggregate_results"
      
    - id: 9
      name: "éªŒè¯éªŒæ”¶"
      action: "validate"
      description: "éªŒè¯æœ€ç»ˆç»“æœ"
      handler: "validator.validate"
      
    - id: 10
      name: "ç”ŸæˆæŠ¥å‘Š"
      action: "report"
      description: "ç”Ÿæˆæ‰§è¡ŒæŠ¥å‘Š"
      handler: "reporter.generate"

# é”™è¯¯å¤„ç†
error_handling:
  max_retries: 3
  retry_delay: 5
  timeout_action: "retry"
  failure_action: "skip_and_continue"

# è¾“å‡ºé…ç½®
output:
  report:
    format: "markdown"
    path: "output/swarm-report.md"
    include:
      - ä»»åŠ¡åˆ†è§£å›¾
      - æ‰§è¡Œæ—¶é—´çº¿
      - å„ Worker è¾“å‡º
      - æœ€ç»ˆç»“æœ
      - æ€§èƒ½ç»Ÿè®¡
      
  artifacts:
    - éªŒè¯æŠ¥å‘Š
    - æ€§èƒ½æŠ¥å‘Š
    - èœ‚ç¾¤æ‰§è¡ŒæŠ¥å‘Š

# æ­¥éª¤å®šä¹‰
steps:
  - id: 1
    name: åˆå§‹åŒ–èœ‚ç¾¤ç¯å¢ƒ
    action: run_command
    params:
      command: |
        echo "=== ğŸ èœ‚ç¾¤æ‰§è¡Œå·¥ä½œæµå¯åŠ¨ ===" &&
        echo "" &&
        echo "æ­£åœ¨åˆå§‹åŒ–èœ‚ç¾¤ç¯å¢ƒ..." &&
        echo "" &&
        mkdir -p .trae/swarm/results &&
        mkdir -p .trae/swarm/workers &&
        echo "âœ… åˆ›å»ºç›®å½•ç»“æ„" &&
        echo "" &&
        echo "ğŸ“ èœ‚ç¾¤å·¥ä½œç›®å½•:" &&
        echo "  - é˜Ÿåˆ—æ–‡ä»¶: .trae/swarm/queue.json" &&
        echo "  - çŠ¶æ€æ–‡ä»¶: .trae/swarm/status.json" &&
        echo "  - ç»“æœç›®å½•: .trae/swarm/results/" &&
        echo "  - Workerç›®å½•: .trae/swarm/workers/"
      save_as: init_result
      timeout: 10

  - id: 2
    name: ä»»åŠ¡åˆ†æ
    action: run_command
    params:
      command: |
        echo "=== ğŸ“Š ä»»åŠ¡åˆ†æ ===" &&
        echo "" &&
        echo "åˆ†æä»»åŠ¡å¤æ‚åº¦..." &&
        echo "" &&
        echo "æ£€æµ‹åˆ°çš„ä»»åŠ¡ç±»å‹:" &&
        echo "  - å¼€å‘ä»»åŠ¡: æ£€æµ‹åˆ°ä»£ç å®ç°éœ€æ±‚" &&
        echo "  - æµ‹è¯•ä»»åŠ¡: æ£€æµ‹åˆ°æµ‹è¯•éªŒè¯éœ€æ±‚" &&
        echo "  - æ–‡æ¡£ä»»åŠ¡: æ£€æµ‹åˆ°æ–‡æ¡£ç¼–å†™éœ€æ±‚" &&
        echo "" &&
        echo "å¤æ‚åº¦è¯„ä¼°: é«˜" &&
        echo "æ¨èæ¨¡å¼: èœ‚ç¾¤æ¨¡å¼ (å¹¶è¡Œæ‰§è¡Œ)"
      save_as: analysis_result
      timeout: 15

  - id: 3
    name: ä»»åŠ¡åˆ†è§£
    action: run_command
    params:
      command: |
        echo "=== ğŸ“‹ ä»»åŠ¡åˆ†è§£ ===" &&
        echo "" &&
        echo "å°†å¤æ‚ä»»åŠ¡æ‹†è§£ä¸ºå­ä»»åŠ¡:" &&
        echo "" &&
        echo "Task 1: [Researcher] è°ƒç ”æŠ€æœ¯æ–¹æ¡ˆ" &&
        echo "  â””â”€ æ— ä¾èµ–ï¼Œå¯ç«‹å³æ‰§è¡Œ" &&
        echo "" &&
        echo "Task 2: [Coder] è®¾è®¡ç³»ç»Ÿæ¶æ„" &&
        echo "  â””â”€ ä¾èµ– Task 1" &&
        echo "" &&
        echo "Task 3: [Coder] å®ç°æ ¸å¿ƒåŠŸèƒ½" &&
        echo "  â””â”€ ä¾èµ– Task 2" &&
        echo "" &&
        echo "Task 4: [Tester] ç¼–å†™æµ‹è¯•ç”¨ä¾‹" &&
        echo "  â””â”€ ä¾èµ– Task 3" &&
        echo "" &&
        echo "Task 5: [Writer] ç¼–å†™æ–‡æ¡£" &&
        echo "  â””â”€ ä¾èµ– Task 3 (å¯ä¸ Task 4 å¹¶è¡Œ)" &&
        echo "" &&
        echo "Task 6: [Reviewer] ä»£ç å®¡æŸ¥" &&
        echo "  â””â”€ ä¾èµ– Task 3, 4, 5"
      save_as: decompose_result
      timeout: 10

  - id: 4
    name: DAGæ„å»º
    action: run_command
    params:
      command: |
        echo "=== ğŸ”— DAG ä¾èµ–å›¾ ===" &&
        echo "" &&
        echo "æ‰§è¡Œå±‚çº§åˆ†æ:" &&
        echo "" &&
        echo "å±‚çº§ 1 (å¹¶è¡Œ): Task 1" &&
        echo "å±‚çº§ 2 (ä¸²è¡Œ): Task 2" &&
        echo "å±‚çº§ 3 (ä¸²è¡Œ): Task 3" &&
        echo "å±‚çº§ 4 (å¹¶è¡Œ): Task 4, Task 5" &&
        echo "å±‚çº§ 5 (ä¸²è¡Œ): Task 6" &&
        echo "" &&
        echo "é¢„è®¡å¹¶è¡ŒåŠ é€Ÿæ¯”: 2.5x"
      save_as: dag_result
      timeout: 10

  - id: 5
    name: æ‰§è¡Œä»»åŠ¡
    action: run_command
    params:
      command: |
        echo "=== ğŸš€ å¹¶è¡Œæ‰§è¡Œ ===" &&
        echo "" &&
        echo "å¯åŠ¨ Worker æ‰§è¡Œ..." &&
        echo "" &&
        echo "Worker åˆ†é…:" &&
        echo "  - Researcher: Task 1" &&
        echo "  - Coder: Task 2, Task 3" &&
        echo "  - Tester: Task 4" &&
        echo "  - Writer: Task 5" &&
        echo "  - Reviewer: Task 6" &&
        echo "" &&
        echo "æ‰§è¡Œè¿›åº¦ç›‘æ§ä¸­..."
      save_as: execute_result
      timeout: 30

  - id: 6
    name: ç»“æœæ•´åˆ
    action: run_command
    params:
      command: |
        echo "=== ğŸ“¦ ç»“æœæ•´åˆ ===" &&
        echo "" &&
        echo "æ”¶é›†å„ Worker è¾“å‡º..." &&
        echo "" &&
        echo "âœ… Task 1 å®Œæˆ (30s)" &&
        echo "âœ… Task 2 å®Œæˆ (120s)" &&
        echo "âœ… Task 3 å®Œæˆ (180s)" &&
        echo "âœ… Task 4 å®Œæˆ (60s) - ä¸ Task 5 å¹¶è¡Œ" &&
        echo "âœ… Task 5 å®Œæˆ (45s) - ä¸ Task 4 å¹¶è¡Œ" &&
        echo "âœ… Task 6 å®Œæˆ (30s)" &&
        echo "" &&
        echo "æ€»æ‰§è¡Œæ—¶é—´: 465s (ä¸²è¡Œé¢„è®¡: 1165s)" &&
        echo "åŠ é€Ÿæ¯”: 2.5x"
      save_as: aggregate_result
      timeout: 10

  - id: 7
    name: ç”ŸæˆæŠ¥å‘Š
    action: notify
    params:
      message: |
        ğŸ‰ èœ‚ç¾¤æ‰§è¡Œå®Œæˆï¼
        
        {{init_result}}
        
        {{analysis_result}}
        
        {{decompose_result}}
        
        {{dag_result}}
        
        {{execute_result}}
        
        {{aggregate_result}}
        
        ğŸ“Š æ‰§è¡Œç»Ÿè®¡:
        - ä»»åŠ¡æ•°: 6
        - Worker æ•°: 5
        - å¹¶è¡Œå±‚çº§: 5
        - åŠ é€Ÿæ¯”: 2.5x
        
        ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶:
        - æ‰§è¡ŒæŠ¥å‘Š: output/swarm-report.md
        - ä»»åŠ¡é˜Ÿåˆ—: .trae/swarm/queue.json
        - ç»“æœæ–‡ä»¶: .trae/swarm/results/
