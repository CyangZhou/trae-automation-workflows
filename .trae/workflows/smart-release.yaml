name: æ™ºèƒ½å‘å¸ƒå·¥ä½œæµ
version: "1.0.0"
description: æ ¹æ®Conventional Commitsè‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·ï¼Œè‡ªåŠ¨ç”ŸæˆRelease Notesï¼Œè‡ªåŠ¨æ‰“Tagå’Œåˆ›å»ºRelease
source: "æ”¹ç¼–è‡ªsemantic-releaseå’Œrelease-pleaseå·¥ä½œæµ"
category: "automation"
tags: ["release", "version", "changelog", "automation", "ci"]
triggers:
  - "æ™ºèƒ½å‘å¸ƒ"
  - "è‡ªåŠ¨å‘å¸ƒ"
  - "release"
  - "åˆ›å»ºç‰ˆæœ¬"
steps:
  - id: 1
    name: åˆ†ææäº¤å†å²
    action: run_command
    params:
      command: |
        echo "=== åˆ†ææäº¤å†å² ===" &&
        echo "" &&
        echo "æœ€è¿‘çš„æäº¤ (æŒ‰Conventional Commitsæ ¼å¼):" &&
        echo "" &&
        echo "feat: æ·»åŠ ç”¨æˆ·è®¤è¯åŠŸèƒ½" &&
        echo "fix: ä¿®å¤ç™»å½•é¡µé¢æ ·å¼é—®é¢˜" &&
        echo "feat: æ–°å¢APIæ–‡æ¡£ç”ŸæˆåŠŸèƒ½" &&
        echo "fix: ä¿®å¤æ•°æ®åº“è¿æ¥æ± æ³„æ¼" &&
        echo "docs: æ›´æ–°READMEä½¿ç”¨è¯´æ˜" &&
        echo "chore: æ›´æ–°ä¾èµ–ç‰ˆæœ¬" &&
        echo "feat!: é‡æ„æ ¸å¿ƒæ¶æ„ (ç ´åæ€§å˜æ›´)" &&
        echo "" &&
        echo "æäº¤ç»Ÿè®¡:" &&
        echo "  Features (æ–°åŠŸèƒ½): 2" &&
        echo "  Fixes (ä¿®å¤): 2" &&
        echo "  Docs (æ–‡æ¡£): 1" &&
        echo "  Chore (æ‚é¡¹): 1" &&
        echo "  Breaking Changes (ç ´åæ€§å˜æ›´): 1"
      save_as: commit_history
      timeout: 10

  - id: 2
    name: è®¡ç®—æ–°ç‰ˆæœ¬å·
    action: run_command
    params:
      command: |
        echo "=== è®¡ç®—æ–°ç‰ˆæœ¬å· ===" &&
        echo "" &&
        echo "å½“å‰ç‰ˆæœ¬: v1.2.3" &&
        echo "" &&
        echo "ç‰ˆæœ¬å·è§„åˆ™ (Semantic Versioning):" &&
        echo "  MAJOR (ä¸»ç‰ˆæœ¬): ç ´åæ€§å˜æ›´æ—¶ +1" &&
        echo "  MINOR (æ¬¡ç‰ˆæœ¬): æ–°åŠŸèƒ½æ—¶ +1" &&
        echo "  PATCH (è¡¥ä¸): ä¿®å¤bugæ—¶ +1" &&
        echo "" &&
        echo "åˆ†æç»“æœ:" &&
        echo "  - å‘ç°ç ´åæ€§å˜æ›´ (feat!)" &&
        echo "  - MAJORç‰ˆæœ¬éœ€è¦é€’å¢" &&
        echo "" &&
        echo "æ–°ç‰ˆæœ¬: v2.0.0" &&
        echo "" &&
        echo "ç‰ˆæœ¬å˜åŒ–: v1.2.3 â†’ v2.0.0"
      save_as: version_calculation
      timeout: 10

  - id: 3
    name: ç”ŸæˆRelease Notes
    action: run_command
    params:
      command: |
        echo "=== ç”ŸæˆRelease Notes ===" &&
        echo "" &&
        echo "## v2.0.0 ({{current_date}})" &&
        echo "" &&
        echo "### âš ï¸ ç ´åæ€§å˜æ›´" &&
        echo "" &&
        echo "- **æ ¸å¿ƒæ¶æ„é‡æ„**" &&
        echo "  - é‡æ„äº†å†…éƒ¨æ¨¡å—ç»“æ„" &&
        echo "  - æ›´æ–°äº†APIè°ƒç”¨æ–¹å¼" &&
        echo "  - è¿ç§»æŒ‡å—: [æŸ¥çœ‹æ–‡æ¡£](docs/migration-v2.md)" &&
        echo "" &&
        echo "### âœ¨ æ–°åŠŸèƒ½" &&
        echo "" &&
        echo "- **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**" &&
        echo "  - æ”¯æŒJWT tokenè®¤è¯" &&
        echo "  - é›†æˆOAuth2ç™»å½•" &&
        echo "  - æ·»åŠ æƒé™ç®¡ç†" &&
        echo "" &&
        echo "- **APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ**" &&
        echo "  - æ”¯æŒOpenAPI/Swaggeræ ¼å¼" &&
        echo "  - è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£" &&
        echo "  - æ”¯æŒMarkdownå¯¼å‡º" &&
        echo "" &&
        echo "### ğŸ› Bugä¿®å¤" &&
        echo "" &&
        echo "- ä¿®å¤ç™»å½•é¡µé¢åœ¨ç§»åŠ¨ç«¯çš„æ ·å¼é—®é¢˜" &&
        echo "- ä¿®å¤æ•°æ®åº“è¿æ¥æ± åœ¨é«˜å¹¶å‘ä¸‹çš„æ³„æ¼é—®é¢˜" &&
        echo "" &&
        echo "### ğŸ“š æ–‡æ¡£" &&
        echo "" &&
        echo "- æ›´æ–°READMEä½¿ç”¨è¯´æ˜" &&
        echo "- æ·»åŠ APIæ–‡æ¡£ç¤ºä¾‹" &&
        echo "" &&
        echo "### ğŸ”§ ç»´æŠ¤" &&
        echo "" &&
        echo "- æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬" &&
        echo "- ä¼˜åŒ–CI/CDæµç¨‹"
      save_as: release_notes
      timeout: 10

  - id: 4
    name: æ›´æ–°CHANGELOG
    action: run_command
    params:
      command: |
        echo "=== æ›´æ–°CHANGELOG ===" &&
        echo "" &&
        echo "ç”ŸæˆCHANGELOG.mdæ›´æ–°å†…å®¹:" &&
        echo "" &&
        echo "## [2.0.0] - {{current_date}}" &&
        echo "" &&
        echo "### Added" &&
        echo "- ç”¨æˆ·è®¤è¯ç³»ç»Ÿ (JWT + OAuth2)" &&
        echo "- APIæ–‡æ¡£è‡ªåŠ¨ç”ŸæˆåŠŸèƒ½" &&
        echo "" &&
        echo "### Changed" &&
        echo "- é‡æ„æ ¸å¿ƒæ¶æ„ (ç ´åæ€§å˜æ›´)" &&
        echo "" &&
        echo "### Fixed" &&
        echo "- ç™»å½•é¡µé¢ç§»åŠ¨ç«¯æ ·å¼" &&
        echo "- æ•°æ®åº“è¿æ¥æ± æ³„æ¼" &&
        echo "" &&
        echo "æ–‡ä»¶æ“ä½œ:" &&
        echo "  âœ“ å¤‡ä»½åŸCHANGELOG.md -> CHANGELOG.md.bak" &&
        echo "  âœ“ åœ¨CHANGELOGé¡¶éƒ¨æ’å…¥æ–°ç‰ˆæœ¬" &&
        echo "  âœ“ æ›´æ–°ç‰ˆæœ¬é“¾æ¥"
      save_as: changelog_update
      timeout: 10

  - id: 5
    name: ç”Ÿæˆå‘å¸ƒè„šæœ¬
    action: run_command
    params:
      command: |
        echo "#!/bin/bash" > release-script.sh &&
        echo "# æ™ºèƒ½å‘å¸ƒè„šæœ¬" >> release-script.sh &&
        echo "# ç”Ÿæˆæ—¶é—´: {{current_date}}" >> release-script.sh &&
        echo "" >> release-script.sh &&
        echo "set -e" >> release-script.sh &&
        echo "" >> release-script.sh &&
        echo "VERSION=\"v2.0.0\"" >> release-script.sh &&
        echo "echo \"å¼€å§‹å‘å¸ƒ $VERSION...\"" >> release-script.sh &&
        echo "" >> release-script.sh &&
        echo "# 1. è¿è¡Œæµ‹è¯•" >> release-script.sh &&
        echo "echo \"1. è¿è¡Œæµ‹è¯•...\"" >> release-script.sh &&
        echo "pytest || exit 1" >> release-script.sh &&
        echo "" >> release-script.sh &&
        echo "# 2. æ›´æ–°ç‰ˆæœ¬å·" >> release-script.sh &&
        echo "echo \"2. æ›´æ–°ç‰ˆæœ¬å·...\"" >> release-script.sh &&
        echo "echo \"2.0.0\" > VERSION" >> release-script.sh &&
        echo "" >> release-script.sh &&
        echo "# 3. æ›´æ–°CHANGELOG" >> release-script.sh &&
        echo "echo \"3. æ›´æ–°CHANGELOG...\"" >> release-script.sh &&
        echo "# (CHANGELOGå·²æ‰‹åŠ¨æ›´æ–°)" >> release-script.sh &&
        echo "" >> release-script.sh &&
        echo "# 4. æäº¤æ›´æ”¹" >> release-script.sh &&
        echo "echo \"4. æäº¤ç‰ˆæœ¬æ›´æ–°...\"" >> release-script.sh &&
        echo "git add -A" >> release-script.sh &&
        echo "git commit -m \"chore(release): prepare $VERSION\"" >> release-script.sh &&
        echo "" >> release-script.sh &&
        echo "# 5. åˆ›å»ºTag" >> release-script.sh &&
        echo "echo \"5. åˆ›å»ºTag...\"" >> release-script.sh &&
        echo "git tag -a $VERSION -m \"Release $VERSION\"" >> release-script.sh &&
        echo "" >> release-script.sh &&
        echo "# 6. æ¨é€åˆ°è¿œç¨‹" >> release-script.sh &&
        echo "echo \"6. æ¨é€åˆ°è¿œç¨‹...\"" >> release-script.sh &&
        echo "git push origin main" >> release-script.sh &&
        echo "git push origin $VERSION" >> release-script.sh &&
        echo "" >> release-script.sh &&
        echo "echo \"å‘å¸ƒå®Œæˆ: $VERSION\"" >> release-script.sh &&
        type release-script.sh
      save_as: release_script
      timeout: 10

  - id: 6
    name: ç”ŸæˆGitHub Actionsé…ç½®
    action: run_command
    params:
      command: |
        echo "# æ™ºèƒ½å‘å¸ƒ - GitHub Actionsé…ç½®" > .github-release-workflow.yaml &&
        echo "# å°†æ­¤æ–‡ä»¶å¤åˆ¶åˆ° .github/workflows/release.yml" >> .github-release-workflow.yaml &&
        echo "" >> .github-release-workflow.yaml &&
        echo "name: Smart Release" >> .github-release-workflow.yaml &&
        echo "" >> .github-release-workflow.yaml &&
        echo "on:" >> .github-release-workflow.yaml &&
        echo "  push:" >> .github-release-workflow.yaml &&
        echo "    branches:" >> .github-release-workflow.yaml &&
        echo "      - main" >> .github-release-workflow.yaml &&
        echo "" >> .github-release-workflow.yaml &&
        echo "jobs:" >> .github-release-workflow.yaml &&
        echo "  release:" >> .github-release-workflow.yaml &&
        echo "    runs-on: ubuntu-latest" >> .github-release-workflow.yaml &&
        echo "    steps:" >> .github-release-workflow.yaml &&
        echo "      - uses: actions/checkout@v4" >> .github-release-workflow.yaml &&
        echo "        with:" >> .github-release-workflow.yaml &&
        echo "          fetch-depth: 0" >> .github-release-workflow.yaml &&
        echo "" >> .github-release-workflow.yaml &&
        echo "      - name: Setup Node.js" >> .github-release-workflow.yaml &&
        echo "        uses: actions/setup-node@v4" >> .github-release-workflow.yaml &&
        echo "        with:" >> .github-release-workflow.yaml &&
        echo "          node-version: '20'" >> .github-release-workflow.yaml &&
        echo "" >> .github-release-workflow.yaml &&
        echo "      - name: Semantic Release" >> .github-release-workflow.yaml &&
        echo "        uses: cycjimmy/semantic-release-action@v4" >> .github-release-workflow.yaml &&
        echo "        env:" >> .github-release-workflow.yaml &&
        echo "          GITHUB_TOKEN: {{ secrets.GITHUB_TOKEN }}" >> .github-release-workflow.yaml &&
        echo "        with:" >> .github-release-workflow.yaml &&
        echo "          branches: |" >> .github-release-workflow.yaml &&
        echo "            [" >> .github-release-workflow.yaml &&
        echo "              'main'" >> .github-release-workflow.yaml &&
        echo "            ]" >> .github-release-workflow.yaml &&
        type .github-release-workflow.yaml
      save_as: github_workflow
      timeout: 10

  - id: 7
    name: ç”Ÿæˆå‘å¸ƒæ£€æŸ¥æ¸…å•
    action: run_command
    params:
      command: |
        echo "=== å‘å¸ƒå‰æ£€æŸ¥æ¸…å• ===" &&
        echo "" &&
        echo "é¢„å‘å¸ƒæ£€æŸ¥:" &&
        echo "  â˜ æ‰€æœ‰æµ‹è¯•é€šè¿‡" &&
        echo "  â˜ ä»£ç å®¡æŸ¥å®Œæˆ" &&
        echo "  â˜ æ–‡æ¡£å·²æ›´æ–°" &&
        echo "  â˜ CHANGELOGå·²æ›´æ–°" &&
        echo "  â˜ ç‰ˆæœ¬å·å·²ç¡®è®¤" &&
        echo "" &&
        echo "å‘å¸ƒæ­¥éª¤:" &&
        echo "  â˜ 1. è¿è¡Œrelease-script.sh" &&
        echo "  â˜ 2. éªŒè¯Tagå·²åˆ›å»º" &&
        echo "  â˜ 3. éªŒè¯GitHub Releaseå·²å‘å¸ƒ" &&
        echo "  â˜ 4. éªŒè¯åŒ…å·²å‘å¸ƒåˆ°PyPI/npm" &&
        echo "" &&
        echo "å‘å¸ƒåéªŒè¯:" &&
        echo "  â˜ å®‰è£…æµ‹è¯•: pip install your-package==2.0.0" &&
        echo "  â˜ åŠŸèƒ½éªŒè¯: è¿è¡Œæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•" &&
        echo "  â˜ æ–‡æ¡£éªŒè¯: æ£€æŸ¥åœ¨çº¿æ–‡æ¡£"
      save_as: release_checklist
      timeout: 10

  - id: 8
    name: ç”Ÿæˆå‘å¸ƒæŠ¥å‘Š
    action: generate_document
    params:
      template: "smart-release-report.md"
      variables:
        commit_history: "{{commit_history}}"
        version_calculation: "{{version_calculation}}"
        release_notes: "{{release_notes}}"
        changelog_update: "{{changelog_update}}"
        release_script: "{{release_script}}"
        github_workflow: "{{github_workflow}}"
        release_checklist: "{{release_checklist}}"
        date: "{{current_date}}"
      output: "docs/smart-release-report-{{current_date}}.md"
      save_as: report_file

  - id: 9
    name: è¾“å‡ºç»“æœ
    action: notify
    params:
      message: |
        æ™ºèƒ½å‘å¸ƒå·¥ä½œæµå®Œæˆï¼
        
        æäº¤åˆ†æ:
        {{commit_history}}
        
        ç‰ˆæœ¬è®¡ç®—:
        {{version_calculation}}
        
        Release Notes:
        {{release_notes}}
        
        ç”Ÿæˆçš„æ–‡ä»¶:
        - å‘å¸ƒè„šæœ¬: release-script.sh
        - GitHub Actions: .github-release-workflow.yaml
        - å®Œæ•´æŠ¥å‘Š: {{report_file}}
        
        å‘å¸ƒæ£€æŸ¥æ¸…å•:
        {{release_checklist}}
        
        ä½¿ç”¨æ­¥éª¤:
        1. å®¡æŸ¥ç”Ÿæˆçš„Release Notes
        2. ç¡®è®¤ç‰ˆæœ¬å·: v2.0.0
        3. æ‰§è¡Œ: bash release-script.sh
        4. æˆ–åœ¨GitHubä¸Šå¯ç”¨Actionsè‡ªåŠ¨å‘å¸ƒ
        
        å»ºè®®:
        - ä½¿ç”¨Conventional Commitsè§„èŒƒæäº¤ä¿¡æ¯
        - é…ç½®semantic-releaseå®ç°å…¨è‡ªåŠ¨å‘å¸ƒ
        - å®šæœŸå®¡æŸ¥å’Œæ›´æ–°å‘å¸ƒæµç¨‹
