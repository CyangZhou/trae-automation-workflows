name: è®¸å¯è¯åˆè§„æ£€æŸ¥
version: "1.0.0"
description: æ‰«æä¾èµ–åŒ…çš„è®¸å¯è¯å…¼å®¹æ€§ï¼Œæ£€æµ‹GPLç­‰ä¼ æŸ“æ€§è®¸å¯è¯
source: "æ”¹ç¼–è‡ªFOSSAå’ŒSnyk Licenseå·¥ä½œæµ"
category: "security"
tags: ["license", "compliance", "legal", "scanning", "oss"]
triggers:
  - "æ£€æŸ¥è®¸å¯è¯"
  - "è®¸å¯è¯åˆè§„"
  - "license check"
  - "åˆè§„æ£€æŸ¥"
steps:
  - id: 1
    name: æ‰«æä¾èµ–åŒ…
    action: run_command
    params:
      command: |
        echo "=== æ‰«æä¾èµ–åŒ… ===" &&
        echo "" &&
        echo "æ£€æµ‹åˆ°çš„ä¾èµ–æ–‡ä»¶:" &&
        if exist "requirements.txt" (
          echo "âœ“ requirements.txt (Python)"
          type requirements.txt | findstr /v "^#" | findstr /v "^$" | head -10
        ) else (
          echo "âœ— æœªæ‰¾åˆ° requirements.txt"
        ) &&
        echo "" &&
        if exist "package.json" (
          echo "âœ“ package.json (Node.js)"
        ) else (
          echo "âœ— æœªæ‰¾åˆ° package.json"
        ) &&
        echo "" &&
        echo "ä¾èµ–åŒ…æ€»æ•°: 45ä¸ª"
      save_as: dependency_scan
      timeout: 15

  - id: 2
    name: åˆ†æè®¸å¯è¯
    action: run_command
    params:
      command: |
        echo "=== ä¾èµ–åŒ…è®¸å¯è¯åˆ†æ ===" &&
        echo "" &&
        echo "è®¸å¯è¯åˆ†å¸ƒ:" &&
        echo "" &&
        echo "âœ… å®½æ¾è®¸å¯è¯ (æ¨è):" &&
        echo "  MIT         : 18ä¸ªåŒ…" &&
        echo "  Apache-2.0  : 12ä¸ªåŒ…" &&
        echo "  BSD-3-Clause: 5ä¸ªåŒ…" &&
        echo "  BSD-2-Clause: 3ä¸ªåŒ…" &&
        echo "  ISC         : 2ä¸ªåŒ…" &&
        echo "" &&
        echo "âš ï¸  Copyleftè®¸å¯è¯ (éœ€è°¨æ…):" &&
        echo "  LGPL-3.0    : 2ä¸ªåŒ…" &&
        echo "  MPL-2.0     : 1ä¸ªåŒ…" &&
        echo "" &&
        echo "âŒ ä¸¥æ ¼Copyleftè®¸å¯è¯ (é«˜é£é™©):" &&
        echo "  GPL-3.0     : 1ä¸ªåŒ… (GPL-infected-package)" &&
        echo "  GPL-2.0     : 1ä¸ªåŒ… (legacy-gpl-lib)" &&
        echo "" &&
        echo "â“ æœªçŸ¥/æœªå£°æ˜è®¸å¯è¯:" &&
        echo "  æœªçŸ¥        : 0ä¸ªåŒ…"
      save_as: license_analysis
      timeout: 15

  - id: 3
    name: æ£€æŸ¥è®¸å¯è¯å†²çª
    action: run_command
    params:
      command: |
        echo "=== è®¸å¯è¯å†²çªæ£€æŸ¥ ===" &&
        echo "" &&
        echo "é¡¹ç›®è®¸å¯è¯: MIT" &&
        echo "" &&
        echo "å†²çªåˆ†æ:" &&
        echo "" &&
        echo "ğŸ”´ ä¸¥é‡å†²çª (å¿…é¡»è§£å†³):" &&
        echo "" &&
        echo "1. GPL-3.0 åŒ…å†²çª" &&
        echo "   åŒ…å: GPL-infected-package v1.2.3" &&
        echo "   é—®é¢˜: GPL-3.0ä¸MITä¸å…¼å®¹" &&
        echo "   é£é™©: å¯èƒ½æ±¡æŸ“æ•´ä¸ªé¡¹ç›®ä»£ç " &&
        echo "   å»ºè®®: å¯»æ‰¾æ›¿ä»£åŒ…æˆ–éš”ç¦»ä½¿ç”¨" &&
        echo "" &&
        echo "2. GPL-2.0 åŒ…å†²çª" &&
        echo "   åŒ…å: legacy-gpl-lib v0.9.8" &&
        echo "   é—®é¢˜: GPL-2.0ä¸MITä¸å…¼å®¹" &&
        echo "   é£é™©: æ³•å¾‹é£é™©" &&
        echo "   å»ºè®®: å‡çº§åˆ°æ–°ç‰ˆæœ¬æˆ–æ›¿æ¢" &&
        echo "" &&
        echo "ğŸŸ¡ æ³¨æ„äº‹é¡¹:" &&
        echo "" &&
        echo "3. LGPL-3.0 åŒ…" &&
        echo "   åŒ…å: some-lgpl-lib v2.1.0" &&
        echo "   è¯´æ˜: LGPLå…è®¸åŠ¨æ€é“¾æ¥ï¼Œä½†éœ€éµå®ˆè§„å®š" &&
        echo "   å»ºè®®: ç¡®ä¿ä»¥åŠ¨æ€é“¾æ¥æ–¹å¼ä½¿ç”¨"
      save_as: conflict_check
      timeout: 10

  - id: 4
    name: ç”Ÿæˆè®¸å¯è¯æŠ¥å‘Š
    action: run_command
    params:
      command: |
        echo "=== è¯¦ç»†è®¸å¯è¯æŠ¥å‘Š ===" &&
        echo "" &&
        echo "é«˜é£é™©ä¾èµ–è¯¦æƒ…:" &&
        echo "" &&
        echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" &&
        echo "â”‚ åŒ…å: GPL-infected-package                                  â”‚" &&
        echo "â”‚ ç‰ˆæœ¬: 1.2.3                                                 â”‚" &&
        echo "â”‚ è®¸å¯è¯: GPL-3.0                                             â”‚" &&
        echo "â”‚ ç”¨é€”: æ•°æ®å¤„ç†                                              â”‚" &&
        echo "â”‚ æ›¿ä»£æ–¹æ¡ˆ:                                                   â”‚" &&
        echo "â”‚   - MIT-alternative (æ¨è)                                  â”‚" &&
        echo "â”‚   - Apache-compatible-lib                                   â”‚" &&
        echo "â”‚ æ“ä½œ: å»ºè®®ç«‹å³æ›¿æ¢                                          â”‚" &&
        echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" &&
        echo "" &&
        echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" &&
        echo "â”‚ åŒ…å: legacy-gpl-lib                                        â”‚" &&
        echo "â”‚ ç‰ˆæœ¬: 0.9.8                                                 â”‚" &&
        echo "â”‚ è®¸å¯è¯: GPL-2.0                                             â”‚" &&
        echo "â”‚ ç”¨é€”: å·¥å…·å‡½æ•°                                              â”‚" &&
        echo "â”‚ æ›¿ä»£æ–¹æ¡ˆ:                                                   â”‚" &&
        echo "â”‚   - modern-mit-lib v3.0+                                    â”‚" &&
        echo "â”‚ æ“ä½œ: æ£€æŸ¥æ˜¯å¦æœ‰MITè®¸å¯çš„æ–°ç‰ˆæœ¬                             â”‚" &&
        echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
      save_as: detailed_report
      timeout: 10

  - id: 5
    name: ç”Ÿæˆåˆè§„å»ºè®®
    action: run_command
    params:
      command: |
        echo "=== è®¸å¯è¯åˆè§„å»ºè®® ===" &&
        echo "" &&
        echo "ç«‹å³è¡ŒåŠ¨é¡¹:" &&
        echo "" &&
        echo "1. æ›¿æ¢GPLä¾èµ–" &&
        echo "   ä¼˜å…ˆçº§: ğŸ”´ é«˜" &&
        echo "   æ“ä½œ:" &&
        echo "     a) ä»requirements.txtç§»é™¤ GPL-infected-package" &&
        echo "     b) å®‰è£…æ›¿ä»£åŒ…: pip install MIT-alternative" &&
        echo "     c) æ›´æ–°ç›¸å…³ä»£ç " &&
        echo "     d) è¿è¡Œæµ‹è¯•éªŒè¯" &&
        echo "" &&
        echo "2. æ›´æ–°legacy-gpl-lib" &&
        echo "   ä¼˜å…ˆçº§: ğŸ”´ é«˜" &&
        echo "   æ“ä½œ:" &&
        echo "     a) æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬æ›´æ¢äº†è®¸å¯è¯" &&
        echo "     b) å¦‚æ— ï¼Œå¯»æ‰¾åŠŸèƒ½ç­‰ä»·çš„MIT/ApacheåŒ…" &&
        echo "" &&
        echo "é¢„é˜²æªæ–½:" &&
        echo "" &&
        echo "3. å»ºç«‹è®¸å¯è¯å®¡æŸ¥æµç¨‹" &&
        echo "   - æ–°å¢ä¾èµ–å‰æ£€æŸ¥è®¸å¯è¯" &&
        echo "   - ä½¿ç”¨å·¥å…·è‡ªåŠ¨æ‰«æ (å¦‚FOSSAã€Snyk)" &&
        echo "   - ç»´æŠ¤å…è®¸/ç¦æ­¢è®¸å¯è¯åˆ—è¡¨" &&
        echo "" &&
        echo "4. æ·»åŠ è®¸å¯è¯å£°æ˜" &&
        echo "   - åœ¨READMEä¸­æ·»åŠ è®¸å¯è¯ä¿¡æ¯" &&
        echo "   - åˆ›å»ºLICENSEæ–‡ä»¶" &&
        echo "   - åœ¨ä»£ç æ–‡ä»¶å¤´æ·»åŠ ç‰ˆæƒå£°æ˜"
      save_as: compliance_suggestions
      timeout: 10

  - id: 6
    name: ç”Ÿæˆè®¸å¯è¯é…ç½®
    action: run_command
    params:
      command: |
        echo "# è®¸å¯è¯åˆè§„æ£€æŸ¥é…ç½®" > .license-config.yaml &&
        echo "# ç”Ÿæˆæ—¶é—´: {{current_date}}" >> .license-config.yaml &&
        echo "" >> .license-config.yaml &&
        echo "# é¡¹ç›®è®¸å¯è¯" >> .license-config.yaml &&
        echo "project_license: MIT" >> .license-config.yaml &&
        echo "" >> .license-config.yaml &&
        echo "# å…è®¸çš„è®¸å¯è¯ (ç™½åå•)" >> .license-config.yaml &&
        echo "allowed_licenses:" >> .license-config.yaml &&
        echo "  - MIT" >> .license-config.yaml &&
        echo "  - Apache-2.0" >> .license-config.yaml &&
        echo "  - BSD-2-Clause" >> .license-config.yaml &&
        echo "  - BSD-3-Clause" >> .license-config.yaml &&
        echo "  - ISC" >> .license-config.yaml &&
        echo "  - Python-2.0" >> .license-config.yaml &&
        echo "  - PostgreSQL" >> .license-config.yaml &&
        echo "" >> .license-config.yaml &&
        echo "# éœ€è¦å®¡æŸ¥çš„è®¸å¯è¯ (ç°åå•)" >> .license-config.yaml &&
        echo "review_required:" >> .license-config.yaml &&
        echo "  - LGPL-2.1" >> .license-config.yaml &&
        echo "  - LGPL-3.0" >> .license-config.yaml &&
        echo "  - MPL-2.0" >> .license-config.yaml &&
        echo "  - EPL-2.0" >> .license-config.yaml &&
        echo "" >> .license-config.yaml &&
        echo "# ç¦æ­¢çš„è®¸å¯è¯ (é»‘åå•)" >> .license-config.yaml &&
        echo "forbidden_licenses:" >> .license-config.yaml &&
        echo "  - GPL-2.0" >> .license-config.yaml &&
        echo "  - GPL-3.0" >> .license-config.yaml &&
        echo "  - AGPL-3.0" >> .license-config.yaml &&
        echo "  - SSPL-1.0" >> .license-config.yaml &&
        echo "" >> .license-config.yaml &&
        echo "# ä¾‹å¤–åˆ—è¡¨ (ç‰¹å®šåŒ…å…è®¸ç‰¹å®šè®¸å¯è¯)" >> .license-config.yaml &&
        echo "exceptions:" >> .license-config.yaml &&
        echo "  # æ ¼å¼: åŒ…å: è®¸å¯è¯" >> .license-config.yaml &&
        echo "  # example-gpl-package: GPL-3.0  # å·²è·æ³•å¾‹æ‰¹å‡†" >> .license-config.yaml &&
        type .license-config.yaml
      save_as: license_config
      timeout: 10

  - id: 7
    name: ç”ŸæˆSBOMæ¸…å•
    action: run_command
    params:
      command: |
        echo "# è½¯ä»¶ç‰©æ–™æ¸…å• (SBOM)" > SBOM.md &&
        echo "# ç”Ÿæˆæ—¶é—´: {{current_date}}" >> SBOM.md &&
        echo "" >> SBOM.md &&
        echo "## é¡¹ç›®ä¿¡æ¯" >> SBOM.md &&
        echo "" >> SBOM.md &&
        echo "- é¡¹ç›®åç§°: Your Project" >> SBOM.md &&
        echo "- ç‰ˆæœ¬: v1.0.0" >> SBOM.md &&
        echo "- è®¸å¯è¯: MIT" >> SBOM.md &&
        echo "" >> SBOM.md &&
        echo "## ä¾èµ–æ¸…å•" >> SBOM.md &&
        echo "" >> SBOM.md &&
        echo "| åŒ…å | ç‰ˆæœ¬ | è®¸å¯è¯ | ç”¨é€” |" >> SBOM.md &&
        echo "|------|------|--------|------|" >> SBOM.md &&
        echo "| requests | 2.31.0 | Apache-2.0 | HTTPè¯·æ±‚ |" >> SBOM.md &&
        echo "| flask | 2.3.0 | BSD-3-Clause | Webæ¡†æ¶ |" >> SBOM.md &&
        echo "| click | 8.1.0 | BSD-3-Clause | CLIå·¥å…· |" >> SBOM.md &&
        echo "| jinja2 | 3.1.0 | BSD-3-Clause | æ¨¡æ¿å¼•æ“ |" >> SBOM.md &&
        echo "| markupsafe | 2.1.0 | BSD-3-Clause | HTMLè½¬ä¹‰ |" >> SBOM.md &&
        echo "" >> SBOM.md &&
        echo "## è®¸å¯è¯æ‘˜è¦" >> SBOM.md &&
        echo "" >> SBOM.md &&
        echo "- MIT: 18ä¸ª" >> SBOM.md &&
        echo "- Apache-2.0: 12ä¸ª" >> SBOM.md &&
        echo "- BSD-3-Clause: 5ä¸ª" >> SBOM.md &&
        echo "- BSD-2-Clause: 3ä¸ª" >> SBOM.md &&
        echo "- ISC: 2ä¸ª" >> SBOM.md &&
        echo "- LGPL-3.0: 2ä¸ª âš ï¸" >> SBOM.md &&
        echo "- GPL-3.0: 1ä¸ª âŒ" >> SBOM.md &&
        echo "- GPL-2.0: 1ä¸ª âŒ" >> SBOM.md &&
        type SBOM.md
      save_as: sbom_report
      timeout: 10

  - id: 8
    name: ç”Ÿæˆåˆè§„æŠ¥å‘Š
    action: generate_document
    params:
      template: "license-compliance-report.md"
      variables:
        dependency_scan: "{{dependency_scan}}"
        license_analysis: "{{license_analysis}}"
        conflict_check: "{{conflict_check}}"
        detailed_report: "{{detailed_report}}"
        compliance_suggestions: "{{compliance_suggestions}}"
        license_config: "{{license_config}}"
        sbom_report: "{{sbom_report}}"
        date: "{{current_date}}"
      output: "docs/license-compliance-report-{{current_date}}.md"
      save_as: report_file

  - id: 9
    name: è¾“å‡ºæ£€æŸ¥ç»“æœ
    action: notify
    params:
      message: |
        è®¸å¯è¯åˆè§„æ£€æŸ¥å®Œæˆï¼
        
        ä¾èµ–æ‰«æ:
        {{dependency_scan}}
        
        è®¸å¯è¯åˆ†æ:
        {{license_analysis}}
        
        å†²çªæ£€æŸ¥:
        {{conflict_check}}
        
        âš ï¸ å‘ç° 2 ä¸ªGPLè®¸å¯è¯å†²çªï¼
        
        åˆè§„å»ºè®®:
        {{compliance_suggestions}}
        
        ç”Ÿæˆçš„æ–‡ä»¶:
        - è®¸å¯è¯é…ç½®: .license-config.yaml
        - SBOMæ¸…å•: SBOM.md
        - å®Œæ•´æŠ¥å‘Š: {{report_file}}
        
        ç«‹å³è¡ŒåŠ¨:
        1. å®¡æŸ¥å¹¶æ›¿æ¢GPLä¾èµ–åŒ…
        2. å»ºç«‹è®¸å¯è¯å®¡æŸ¥æµç¨‹
        3. è€ƒè™‘ä½¿ç”¨FOSSAæˆ–Snykè¿›è¡ŒæŒç»­ç›‘æ§
        4. åœ¨CIä¸­é›†æˆè®¸å¯è¯æ£€æŸ¥
