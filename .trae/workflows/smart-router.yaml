name: smart-router
description: æ™ºèƒ½è·¯ç”±ç³»ç»Ÿ v3.0 - è‡ªåŠ¨åˆ¤æ–­ä»»åŠ¡ç±»å‹ï¼Œé€‰æ‹©æœ€ä¼˜æ‰§è¡Œæ–¹å¼ï¼ˆå•Agent/èœ‚ç¾¤æ¨¡å¼ï¼‰ï¼Œå¹¶å¼ºåˆ¶æ‰§è¡ŒéªŒè¯éªŒæ”¶
version: "3.0.0"

trigger:
  type: auto
  keywords:
    - å¼€å§‹
    - ç»§ç»­
    - è‡ªä¸»æ‰§è¡Œ
    - æ™ºèƒ½è·¯ç”±
    - è‡ªåŠ¨éªŒè¯
    - èœ‚ç¾¤
    - å¹¶è¡Œæ‰§è¡Œ
    - /swarm

# æ™ºèƒ½è·¯ç”±é…ç½®
routing:
  # ä»»åŠ¡ç±»å‹è¯†åˆ«è§„åˆ™
  task_patterns:
    standard:
      patterns:
        - "å®‰å…¨æ‰«æ"
        - "ä»£ç å®¡æŸ¥"
        - "æµ‹è¯•è¦†ç›–ç‡"
        - "ä¾èµ–æ£€æŸ¥"
        - "æ€§èƒ½æµ‹è¯•"
      action: "workflow"
      reason: "æ ‡å‡†åŒ–ä»»åŠ¡ï¼Œä½¿ç”¨é¢„å®šä¹‰å·¥ä½œæµ"
      
    repetitive:
      patterns:
        - "æ¯å¤©"
        - "æ¯å‘¨"
        - "å®šæ—¶"
        - "è‡ªåŠ¨"
      action: "workflow"
      reason: "é‡å¤æ€§ä»»åŠ¡ï¼Œç”Ÿæˆå¯å¤ç”¨å·¥ä½œæµ"
      
    one_time:
      patterns:
        - "å¸®æˆ‘å†™"
        - "ä¿®æ”¹è¿™ä¸ª"
        - "ä¼˜åŒ–ä¸€ä¸‹"
        - "ä¿®å¤"
      action: "builtin"
      reason: "ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œä½¿ç”¨å†…ç½®å·¥å…·"
      
    complex:
      patterns:
        - "é‡æ„"
        - "æ¶æ„"
        - "ç³»ç»Ÿè®¾è®¡"
        - "å¼€å‘ä¸€ä¸ª"
        - "å®ç°ä¸€ä¸ª"
        - "æ„å»º"
      action: "swarm"
      reason: "å¤æ‚ä»»åŠ¡ï¼Œå¯åŠ¨èœ‚ç¾¤æ¨¡å¼"

  # ğŸ†• èœ‚ç¾¤æ¨¡å¼é…ç½®
  swarm_mode:
    enabled: true
    trigger_conditions:
      - complexity: "complex"
      - user_request: ["å¹¶è¡Œæ‰§è¡Œ", "èœ‚ç¾¤æ¨¡å¼", "/swarm"]
      - estimated_time: ">5min"
    
    orchestrator:
      skill: "swarm-orchestrator"
      
    workers:
      researcher:
        max_instances: 2
        timeout: 180
      coder:
        max_instances: 3
        timeout: 600
      tester:
        max_instances: 2
        timeout: 300
      writer:
        max_instances: 1
        timeout: 180
      reviewer:
        max_instances: 1
        timeout: 180

# éªŒè¯éªŒæ”¶é…ç½®ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰
validation:
  enabled: true
  strict: true
  
  code_quality:
    - name: "è¯­æ³•æ£€æŸ¥"
      type: "lint"
      tools: ["eslint", "html-validate", "stylelint"]
      fail_action: "block"
      
    - name: "ç±»å‹æ£€æŸ¥"
      type: "typecheck"
      tools: ["tsc", "mypy"]
      fail_action: "block"
      
  runtime:
    - name: "åŠŸèƒ½æµ‹è¯•"
      type: "functional"
      tests:
        - "æ ¸å¿ƒåŠŸèƒ½å¯äº¤äº’"
        - "è¡¨å•å¯æäº¤"
        - "æŒ‰é’®å¯ç‚¹å‡»"
      fail_action: "block"
      
    - name: "è¾¹ç•Œæµ‹è¯•"
      type: "boundary"
      tests:
        - "ç©ºè¾“å…¥å¤„ç†"
        - "è¶…é•¿è¾“å…¥å¤„ç†"
        - "ç‰¹æ®Šå­—ç¬¦å¤„ç†"
      fail_action: "warn"

# æ‰§è¡Œæµç¨‹
workflow:
  steps:
    - id: 1
      name: "ä»»åŠ¡åˆ†æ"
      action: "analyze"
      description: "åˆ†æä»»åŠ¡ç±»å‹ï¼Œç¡®å®šæ‰§è¡Œæ–¹å¼"
      
    - id: 2
      name: "è·¯ç”±å†³ç­–"
      action: "route"
      description: "æ ¹æ®åˆ†æç»“æœé€‰æ‹©æ‰§è¡Œè·¯å¾„"
      
    - id: 3
      name: "æ‰§è¡Œæ¨¡å¼é€‰æ‹©"
      action: "select_mode"
      description: |
        æ ¹æ®ä»»åŠ¡å¤æ‚åº¦é€‰æ‹©æ‰§è¡Œæ¨¡å¼ï¼š
        - ç®€å•ä»»åŠ¡ â†’ å•Agentæ‰§è¡Œ
        - å¤æ‚ä»»åŠ¡ â†’ èœ‚ç¾¤æ¨¡å¼
        
    - id: 4
      name: "æ‰§è¡Œä»»åŠ¡"
      action: "execute"
      description: "æ‰§è¡Œå…·ä½“ä»»åŠ¡ï¼ˆå†…ç½®å·¥å…·/å·¥ä½œæµ/èœ‚ç¾¤æ¨¡å¼ï¼‰"
      modes:
        builtin: "ä½¿ç”¨å†…ç½®å·¥å…·ç›´æ¥æ‰§è¡Œ"
        workflow: "è°ƒç”¨é¢„å®šä¹‰å·¥ä½œæµ"
        swarm: "å¯åŠ¨èœ‚ç¾¤æ¨¡å¼å¹¶è¡Œæ‰§è¡Œ"
      
    - id: 5
      name: "ä»£ç è´¨é‡éªŒè¯"
      action: "validate"
      type: "code_quality"
      description: "è¿è¡Œé™æ€ä»£ç æ£€æŸ¥"
      on_failure: "block"
      
    - id: 6
      name: "è¿è¡Œæ—¶éªŒè¯"
      action: "validate"
      type: "runtime"
      description: "è¿è¡ŒåŠŸèƒ½å’Œè¾¹ç•Œæµ‹è¯•"
      on_failure: "block"
      
    - id: 7
      name: "éªŒæ”¶ç¡®è®¤"
      action: "accept"
      description: "ç¡®è®¤æ‰€æœ‰éªŒè¯é€šè¿‡ï¼Œç”ŸæˆæŠ¥å‘Š"
      
    - id: 8
      name: "è‡ªåŠ¨ä¿®å¤"
      action: "heal"
      condition: "validation_failed"
      description: "è‡ªåŠ¨ä¿®å¤å‘ç°çš„é—®é¢˜"
      max_attempts: 3

# ğŸ†• èœ‚ç¾¤æ¨¡å¼æ‰§è¡Œæµç¨‹
swarm_workflow:
  steps:
    - id: 1
      name: "ä»»åŠ¡åˆ†è§£"
      action: "decompose"
      handler: "orchestrator.decompose_task"
      description: "å°†å¤æ‚ä»»åŠ¡æ‹†è§£ä¸ºå­ä»»åŠ¡"
      
    - id: 2
      name: "DAGæ„å»º"
      action: "build_dag"
      handler: "orchestrator.build_dag"
      description: "è¯†åˆ«ä»»åŠ¡é—´ä¾èµ–å…³ç³»"
      
    - id: 3
      name: "åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—"
      action: "create_queue"
      handler: "orchestrator.create_queue"
      description: "å°†ä»»åŠ¡å†™å…¥é˜Ÿåˆ—æ–‡ä»¶"
      
    - id: 4
      name: "Workeråˆ†å‘"
      action: "dispatch"
      handler: "orchestrator.dispatch_workers"
      description: "å°†ä»»åŠ¡åˆ†å‘ç»™åˆé€‚çš„Worker"
      
    - id: 5
      name: "å¹¶è¡Œæ‰§è¡Œ"
      action: "execute_parallel"
      handler: "workers.execute"
      description: "Workerå¹¶è¡Œæ‰§è¡Œä»»åŠ¡"
      parallel: true
      
    - id: 6
      name: "è¿›åº¦ç›‘æ§"
      action: "monitor"
      handler: "orchestrator.monitor_progress"
      description: "ç›‘æ§æ‰§è¡Œè¿›åº¦"
      loop: true
      interval: 5
      
    - id: 7
      name: "ç»“æœæ•´åˆ"
      action: "aggregate"
      handler: "orchestrator.aggregate_results"
      description: "æ”¶é›†å¹¶æ•´åˆæ‰€æœ‰ç»“æœ"
      
    - id: 8
      name: "éªŒè¯éªŒæ”¶"
      action: "validate"
      handler: "validator.validate"
      description: "éªŒè¯æœ€ç»ˆç»“æœ"

# è¾“å‡ºé…ç½®
output:
  report:
    format: "markdown"
    path: "output/validation-report.md"
    include:
      - "æ‰§è¡Œæ—¥å¿—"
      - "éªŒè¯ç»“æœ"
      - "æ€§èƒ½æŒ‡æ ‡"
      - "ä¿®å¤è®°å½•"
      - "èœ‚ç¾¤æ‰§è¡ŒæŠ¥å‘Š"
      
  artifacts:
    - "éªŒè¯æŠ¥å‘Š"
    - "æ€§èƒ½æŠ¥å‘Š"
    - "ä¿®å¤åçš„ä»£ç "
    - "èœ‚ç¾¤æ‰§è¡ŒæŠ¥å‘Š"
